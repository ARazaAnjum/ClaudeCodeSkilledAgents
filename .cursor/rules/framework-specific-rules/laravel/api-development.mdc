---
description: Laravel API development patterns and standards
globs: ["app/Http/Controllers/Api/**/*.php", "app/Http/Resources/**/*.php", "app/Http/Requests/**/*.php"]
---

# Laravel API Development Rules

## API Development (REQUIRED)
```php
// ALWAYS use this controller pattern
class ExampleController extends Controller
{
    public function index(Request $request): JsonResponse
    {
        try {
            // ALWAYS validate tenant access
            $this->authorize('viewAny', Model::class);
            
            // ALWAYS use service layer
            $data = $this->service->getData($request);
            
            // ALWAYS use API resources
            return response()->json([
                'success' => true,
                'data' => ModelResource::collection($data),
                'meta' => $this->getPaginationMeta($data)
            ]);
        } catch (\Exception $e) {
            // ALWAYS log errors
            \Log::error('Controller error: ' . $e->getMessage());
            
            // ALWAYS return consistent error format
            return response()->json([
                'success' => false,
                'message' => 'Operation failed',
                'error' => app()->environment('local') ? $e->getMessage() : null
            ], 500);
        }
    }
}
```

## Database Queries (PERFORMANCE CRITICAL)
- ALWAYS use eager loading to prevent N+1 queries
- ALWAYS add indexes for frequently queried columns
- ALWAYS use pagination for large datasets
- ALWAYS implement query scopes for reusable logic
- ALWAYS use chunking for large data processing

```php
// ALWAYS use this query pattern
Model::query()
    ->with(['relation1', 'relation2']) // ALWAYS eager load
    ->where('team_id', auth()->user()->current_team_id) // ALWAYS filter by tenant
    ->when($request->search, fn($q) => $q->search($request->search))
    ->orderBy($request->sort ?? 'created_at', $request->direction ?? 'desc')
    ->paginate($request->per_page ?? 25);
```

## Caching Strategy (PERFORMANCE)
- ALWAYS cache expensive queries
- ALWAYS use cache tags for easy invalidation
- ALWAYS implement cache warming strategies
- ALWAYS set appropriate cache TTL
- ALWAYS clear cache on data updates

```php
// ALWAYS use this caching pattern
public function getCachedData(int $teamId): Collection
{
    return Cache::tags(['team:' . $teamId, 'models'])
        ->remember(
            "models:team:{$teamId}",
            now()->addHours(1),
            fn() => Model::where('team_id', $teamId)->get()
        );
}
```

## Performance Monitoring (REQUIRED)
- ALWAYS monitor query execution time
- ALWAYS log slow queries
- ALWAYS implement performance metrics
- ALWAYS use database query optimization
- ALWAYS profile memory usage
